<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Infinity Gold â€” Material 3</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        :root {
            --primary: #D0BCFF;
            --on-primary: #381E72;
            --primary-container: #4F378B;
            --on-primary-container: #EADDFF;
            --surface: #0F0D13;
            --on-surface: #E6E1E5;
            --surface-variant: #49454F;
            --surface-container: #1D1B20;
            --outline: #938F99;
            --progress: 0%;
        }

        body.light-mode {
            --primary: #6750A4;
            --on-primary: #FFFFFF;
            --primary-container: #EADDFF;
            --on-primary-container: #21005D;
            --surface: #FEF7FF;
            --on-surface: #1D1B20;
            --surface-variant: #E7E0EB;
            --surface-container: #F3EDF7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            font-family: 'Google Sans', sans-serif;
            background-color: var(--surface);
            color: var(--on-surface);
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            transition: background 0.3s ease;
        }

        /* Loading Bar */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 3px;
            background: transparent; z-index: 9999; overflow: hidden; display: none;
        }
        #loader.active { display: block; }
        .loader-fill { width: 40%; height: 100%; background: var(--primary); position: absolute; left: -40%; animation: flow 1.2s infinite linear; }
        @keyframes flow { from { left: -40%; } to { left: 100%; } }

        /* Main Layout */
        header { padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; }
        .brand { font-size: 22px; font-weight: 700; color: var(--primary); letter-spacing: -1px; }

        main { height: calc(100vh - 140px); overflow-y: auto; padding: 0 16px 150px; scrollbar-width: none; }
        main::-webkit-scrollbar { display: none; }

        .search-area { position: sticky; top: 0; background: var(--surface); padding: 8px 0; z-index: 20; }
        .search-bar { background: var(--surface-container); border-radius: 28px; height: 52px; display: flex; align-items: center; padding: 0 18px; transition: 0.2s; border: 1px solid transparent; }
        .search-bar:focus-within { border-color: var(--primary); }
        .search-bar input { flex: 1; background: none; border: none; color: var(--on-surface); font-size: 16px; margin-left: 10px; }

        .chips { display: flex; gap: 8px; overflow-x: auto; margin-top: 12px; scrollbar-width: none; }
        .chip { background: var(--surface-container); padding: 8px 16px; border-radius: 12px; font-size: 13px; font-weight: 500; white-space: nowrap; cursor: pointer; }
        .chip.active { background: var(--primary); color: var(--on-primary); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(145px, 1fr)); gap: 12px; margin-top: 16px; }
        .card { background: var(--surface-container); padding: 10px; border-radius: 20px; cursor: pointer; transition: 0.2s; }
        .card img { width: 100%; aspect-ratio: 1; border-radius: 14px; object-fit: cover; margin-bottom: 8px; }
        .card .t { font-weight: 500; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card .a { font-size: 12px; opacity: 0.6; }

        /* Footer */
        footer { text-align: center; padding: 40px 0 20px; font-size: 11px; opacity: 0.5; line-height: 2; }
        .disclaimer-link { text-decoration: underline; cursor: pointer; color: var(--primary); font-weight: 700; }

        /* Players */
        #miniPlayer {
            position: fixed; bottom: 12px; left: 12px; right: 12px;
            background: var(--primary-container); color: var(--on-primary-container);
            height: 64px; border-radius: 16px; display: flex; align-items: center;
            padding: 0 12px; gap: 12px; transform: translateY(200%); transition: 0.4s;
            z-index: 1000; cursor: pointer; box-shadow: 0 8px 30px rgba(0,0,0,0.5);
        }
        #miniPlayer.active { transform: translateY(0); }
        .m-art { width: 44px; height: 44px; border-radius: 8px; object-fit: cover; }
        .m-info { flex: 1; overflow: hidden; }
        .m-info h4 { margin: 0; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        #fullPlayer {
            position: fixed; inset: 0; background: var(--surface); z-index: 2000;
            display: none; flex-direction: column; padding: 20px; overflow-y: auto;
        }
        .f-nav { display: flex; justify-content: space-between; align-items: center; }
        .f-art-wrap { display: flex; justify-content: center; padding: 30px 0; }
        .f-img { width: 80vw; max-width: 300px; aspect-ratio: 1; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }

        .f-meta h2 { margin: 0; font-size: 24px; }
        .f-meta p { margin: 4px 0 0; font-size: 18px; color: var(--primary); }

        .seeker-box { margin: 24px 0; }
        .slider {
            -webkit-appearance: none; width: 100%; height: 4px; border-radius: 2px;
            background: linear-gradient(to right, var(--primary) var(--progress), var(--surface-variant) var(--progress));
            outline: none; cursor: pointer;
        }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--primary); border-radius: 50%; }

        .f-ctrls { display: flex; justify-content: space-between; align-items: center; }
        .play-btn { width: 72px; height: 72px; border-radius: 50%; background: var(--primary-container); color: var(--on-primary-container); display: flex; align-items: center; justify-content: center; }
        .icon-btn { background: none; border: none; color: var(--on-surface); cursor: pointer; padding: 10px; border-radius: 50%; display: flex; }

        /* Extra Controls */
        .extra-ctrls { display: flex; align-items: center; justify-content: space-around; margin: 30px 0; background: var(--surface-container); padding: 15px; border-radius: 20px; }
        .vol-slider { width: 80px; accent-color: var(--primary); cursor: pointer; }
        .speed-btn { font-family: 'Roboto Mono'; font-weight: 700; font-size: 12px; color: var(--primary); }

        /* Disclaimer Modal */
        #modalOverlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px); z-index: 3000;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-box {
            background: var(--surface-container); padding: 30px; border-radius: 28px;
            max-width: 400px; width: 100%; border: 1px solid var(--outline);
            text-align: center; animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modalIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-box h3 { margin: 0 0 15px; color: var(--primary); }
        .modal-box p { font-size: 14px; line-height: 1.6; opacity: 0.8; margin-bottom: 25px; }
        .modal-close { background: var(--primary); color: var(--on-primary); border: none; padding: 12px 30px; border-radius: 20px; font-weight: 700; cursor: pointer; }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--on-surface); color: var(--surface); padding: 12px 24px; border-radius: 30px; font-size: 14px; opacity: 0; transition: 0.3s; z-index: 9999; }
    </style>
</head>
<body>

    <div id="loader"><div class="loader-fill"></div></div>

    <header>
        <div class="brand">AURA</div>
        <button class="icon-btn" onclick="toggleTheme()"><span class="material-symbols-rounded" id="themeIcon">dark_mode</span></button>
    </header>

    <main>
        <div class="search-area">
            <div class="search-bar">
                <span class="material-symbols-rounded">search</span>
                <input type="text" id="searchInp" placeholder="Search song or artist..." autocomplete="off">
            </div>
            <div class="chips">
                <div class="chip active" onclick="search('Trending Hindi', this)">Trending</div>
                <div class="chip" onclick="search('Lofi Beats', this)">Lo-Fi</div>
                <div class="chip" onclick="search('Top English Songs', this)">Global</div>
                <div class="chip" onclick="search('New Releases', this)">Latest</div>
            </div>
        </div>
        <div class="grid" id="mainGrid"></div>
        
        <footer>
            MADE BY BHARGAV TODIMELA<br>
            <span class="disclaimer-link" onclick="toggleModal(true)">Disclaimer</span>
        </footer>
    </main>

    <!-- Disclaimer Modal -->
    <div id="modalOverlay" onclick="toggleModal(false)">
        <div class="modal-box" onclick="event.stopPropagation()">
            <span class="material-symbols-rounded" style="font-size: 48px; color: var(--primary); margin-bottom: 10px;">info</span>
            <h3>Disclaimer</h3>
            <p>Since we use an unofficial JioSaavn API, it is common to see errors in playback, occasional throttling, or slow loading by the servers. We are always trying to make our services useful to you. Thank you for using Aura.</p>
            <button class="modal-close" onclick="toggleModal(false)">GOT IT</button>
        </div>
    </div>

    <!-- Mini Player -->
    <div id="miniPlayer" onclick="expandPlayer(true)">
        <img src="" id="mArt" class="m-art">
        <div class="m-info"><h4 id="mTitle">Not Playing</h4><span id="mArtist" style="font-size:12px;opacity:0.7">Select a track</span></div>
        <button class="icon-btn" onclick="event.stopPropagation(); togglePlay()"><span class="material-symbols-rounded" id="mPlayIcon" style="font-size:35px">play_arrow</span></button>
    </div>

    <!-- Full Player -->
    <div id="fullPlayer">
        <div class="f-nav">
            <button class="icon-btn" onclick="expandPlayer(false)"><span class="material-symbols-rounded">expand_more</span></button>
            <span style="font-size:12px; font-weight:700">AURA PLAYER</span>
            <button class="icon-btn" onclick="downloadCurrent()"><span class="material-symbols-rounded">download</span></button>
        </div>

        <div class="f-art-wrap"><img src="" id="fArt" class="f-img"></div>
        <div class="f-meta"><h2 id="fTitle">Song Title</h2><p id="fArtist">Artist Name</p></div>

        <div class="seeker-box">
            <input type="range" class="slider" id="seeker" value="0">
            <div style="display:flex; justify-content: space-between; margin-top:10px; font-family:'Roboto Mono'; font-size:11px; opacity:0.6">
                <span id="curT">0:00</span><span id="totT">0:00</span>
            </div>
        </div>

        <div class="f-ctrls">
            <button class="icon-btn" onclick="toggleShuffle()"><span class="material-symbols-rounded" id="shuff">shuffle</span></button>
            <div class="main-btns">
                <button class="icon-btn" onclick="prev()"><span class="material-symbols-rounded" style="font-size:35px">skip_previous</span></button>
                <div class="play-btn" onclick="togglePlay()"><span class="material-symbols-rounded" style="font-size:45px" id="fPlayIcon">play_arrow</span></div>
                <button class="icon-btn" onclick="next()"><span class="material-symbols-rounded" style="font-size:35px">skip_next</span></button>
            </div>
            <button class="icon-btn" onclick="toggleLoop()"><span class="material-symbols-rounded" id="loop">repeat</span></button>
        </div>

        <div class="extra-ctrls">
            <div style="display:flex; align-items:center; gap:8px">
                <span class="material-symbols-rounded" style="font-size:18px">volume_up</span>
                <input type="range" class="vol-slider" id="volCtrl" min="0" max="1" step="0.1" value="1">
            </div>
            <button class="icon-btn speed-btn" onclick="cycleSpeed()" id="speedBtn">1x</button>
            <button class="icon-btn" onclick="showToast('Up Next: Coming soon!')">
                <span class="material-symbols-rounded">queue_music</span>
            </button>
        </div>
    </div>

    <div id="toast">Message</div>
    <audio id="audio" crossorigin="anonymous"></audio>

    <script>
        const API = "https://jiosaavn-api.bhargavtodimela4.workers.dev/api";
        const audio = document.getElementById('audio');
        let queue = [];
        let curIdx = -1;
        let isLoop = false;
        let speeds = [1, 1.25, 1.5, 2, 0.5];
        let sIdx = 0;

        // --- Core ---
        async function fetchAPI(url) {
            document.getElementById('loader').classList.add('active');
            try {
                const r = await fetch(API + url);
                const d = await r.json();
                return d.data;
            } catch(e) { return null; }
            finally { document.getElementById('loader').classList.remove('active'); }
        }

        const inp = document.getElementById('searchInp');
        inp.onchange = () => search(inp.value);

        async function search(q, el) {
            if(el) {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                el.classList.add('active');
                inp.value = q;
            }
            const data = await fetchAPI(`/search/songs?query=${encodeURIComponent(q)}`);
            if(data) {
                queue = data.results.map(s => ({
                    id: s.id, name: clean(s.name), artist: clean(s.artists.primary[0].name),
                    image: s.image[s.image.length-1].url, url: s.downloadUrl[s.downloadUrl.length-1].url
                }));
                renderGrid();
            }
        }

        function renderGrid() {
            document.getElementById('mainGrid').innerHTML = queue.map((s, i) => `
                <div class="card" onclick="playSong(${i})">
                    <img src="${s.image}" loading="lazy">
                    <div class="t">${s.name}</div>
                    <div class="a">${s.artist}</div>
                </div>
            `).join('');
        }

        function playSong(idx) {
            curIdx = idx;
            const s = queue[curIdx];
            audio.src = s.url;
            audio.play().catch(() => showToast("Playback Error: API Throttled"));
            document.getElementById('miniPlayer').classList.add('active');
            updateUI(s);
        }

        function updateUI(s) {
            document.getElementById('mArt').src = document.getElementById('fArt').src = s.image;
            document.getElementById('mTitle').innerText = document.getElementById('fTitle').innerText = s.name;
            document.getElementById('mArtist').innerText = document.getElementById('fArtist').innerText = s.artist;
            syncIcons();
        }

        function togglePlay() {
            if(audio.paused) audio.play(); else audio.pause();
            syncIcons();
        }

        function syncIcons() {
            const icon = audio.paused ? 'play_arrow' : 'pause';
            document.getElementById('mPlayIcon').innerText = icon;
            document.getElementById('fPlayIcon').innerText = icon;
        }

        audio.onplay = syncIcons;
        audio.onpause = syncIcons;

        function next() { if(curIdx < queue.length - 1) playSong(curIdx + 1); }
        function prev() { if(curIdx > 0) playSong(curIdx - 1); }

        audio.ontimeupdate = () => {
            const p = (audio.currentTime / audio.duration) * 100 || 0;
            document.getElementById('seeker').value = p;
            document.documentElement.style.setProperty('--progress', p + '%');
            document.getElementById('curT').innerText = fmt(audio.currentTime);
            document.getElementById('totT').innerText = fmt(audio.duration);
        };

        document.getElementById('seeker').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;
        audio.onended = () => isLoop ? audio.play() : next();

        // --- Features ---
        document.getElementById('volCtrl').oninput = (e) => audio.volume = e.target.value;

        function cycleSpeed() {
            sIdx = (sIdx + 1) % speeds.length;
            audio.playbackRate = speeds[sIdx];
            document.getElementById('speedBtn').innerText = speeds[sIdx] + 'x';
        }

        function toggleLoop() {
            isLoop = !isLoop;
            document.getElementById('loop').style.color = isLoop ? 'var(--primary)' : 'inherit';
        }

        async function downloadCurrent() {
            if(curIdx === -1) return;
            const song = queue[curIdx];
            showToast("Downloading... Check notifications");

            try {
                // Mobile-friendly blob download
                const response = await fetch(song.url);
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${song.name}.mp3`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } catch (e) {
                // Fallback for strict browsers
                window.open(song.url, '_blank');
            }
        }

        function toggleModal(show) {
            document.getElementById('modalOverlay').style.display = show ? 'flex' : 'none';
        }

        // --- Utils ---
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            document.getElementById('themeIcon').innerText = document.body.classList.contains('light-mode') ? 'light_mode' : 'dark_mode';
        }
        function expandPlayer(s) { document.getElementById('fullPlayer').style.display = s ? 'flex' : 'none'; }
        function fmt(s) { if(isNaN(s)) return '0:00'; const m = Math.floor(s/60); const sc = Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sc}`; }
        function clean(h) { const t = document.createElement("textarea"); t.innerHTML = h; return t.value; }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 2500); }

        window.onload = () => search("Trending Hindi");
    </script>
</body>
</html>
