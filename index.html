<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="google-site-verification" content="dO40MJsX5bbJwAuRYl8ewUiN7YD_LD7attdIkx2JzKQ" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Bhargav Music Player ‚Äî Online Music, JioSaavn SEO, Telugu Songs</title>

    <!-- SEO Description -->
    <meta name="description" content="Enjoy all songs for free ‚Äî stream online with no ads and 100% uptime. Made by Bhargav Todimela. Telugu songs, JioSaavn search, fast music player." />

    <!-- SEO Keywords -->
    <meta name="keywords" content="
        jio saavn, saavn, music player, music online, music player online,
        bhargav music player, bhargav vercel, vercel, vercel music player,
        music player vercel, jio vercel, music vercel, telugu songs, music,
        kl university projects, github music, github bhargav, bhargav kl,
        kl university music player, bhargav kl university music player,
        bhargav github, bhargav kl university github, kl sac, kl erp,
        kl lms, kl university, project by klu students
    " />

    <!-- Open Graph (Facebook / LinkedIn) -->
    <meta property="og:title" content="Bhargav Music Player ‚Äî Stream All Songs Free" />
    <meta property="og:description" content="Enjoy all songs online ‚Äî no ads, 100% uptime. Built by Bhargav Todimela." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://your-vercel-url.vercel.app" />
    <meta property="og:image" content="https://your-thumbnail-image-url.jpg" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Bhargav Music Player ‚Äî Online Songs (No Ads)" />
    <meta name="twitter:description" content="Stream any song free with 100% uptime. Created by Bhargav Todimela." />
    <meta name="twitter:image" content="https://your-thumbnail-image-url.jpg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ffcc;
            --bg-color: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.4);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #b3b3b3;
            --heart: #ff4d4d;
            --player-bg: rgba(20, 20, 20, 0.9);
            --toast-bg: #333;
        }

        body.light-mode {
            --primary: #008f8f;
            --bg-color: #f0f2f5;
            --card-bg: rgba(255, 255, 255, 0.8);
            --glass: rgba(0, 0, 0, 0.05);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-main: #1a1a1a;
            --text-muted: #666666;
            --heart: #e60023;
            --player-bg: rgba(255, 255, 255, 0.9);
            --toast-bg: #fff;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 160px;
            transition: background 0.3s, color 0.3s;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 600px;
            margin: 20px 0;
        }

        .theme-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .theme-btn:hover {
            background: rgba(128, 128, 128, 0.2);
        }

        h1 {
            text-align: center;
            font-weight: 600;
            background: linear-gradient(135deg, #00ffcc, #00b4d8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            font-size: 1.8rem;
            letter-spacing: -1px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--glass);
            padding: 5px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 8px 20px;
            font-size: 15px;
            font-family: inherit;
            cursor: pointer;
            border-radius: 25px;
            transition: 0.3s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: #fff;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .search-container {
            width: 90%;
            max-width: 600px;
            position: relative;
            margin-bottom: 30px;
        }

        #searchBox {
            width: 100%;
            padding: 18px 25px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            background: var(--glass);
            color: var(--text-main);
            font-size: 16px;
            font-family: inherit;
            outline: none;
            backdrop-filter: blur(10px);
            transition: 0.3s ease;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        #searchBox:focus {
            background: var(--glass);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.15);
        }

        .view-section {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
        }

        .view-section:not(.hidden) {
            display: flex;
        }

        .hidden {
            display: none !important;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            padding-bottom: 20px;
        }

        .list-container {
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 12px;
            gap: 15px;
            border: 1px solid var(--glass-border);
            transition: 0.3s;
        }

        .queue-item.active {
            border-color: var(--primary);
            background: rgba(0, 255, 204, 0.05);
        }

        .queue-item img {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: cover;
        }

        .queue-info {
            flex: 1;
        }

        .queue-actions {
            display: flex;
            gap: 5px;
        }

        .queue-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .queue-btn:hover {
            color: var(--primary);
            background: var(--glass);
            border-radius: 4px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            contain: content;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card img {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            object-fit: cover;
            margin-bottom: 12px;
            background: #222;
        }

        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .card-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-main);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .card-artist {
            font-size: 13px;
            color: var(--text-muted);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 2;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            backdrop-filter: blur(4px);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
            fill: none;
            stroke: white;
            stroke-width: 2;
        }

        .action-btn.fav.active svg {
            fill: var(--heart);
            stroke: var(--heart);
        }

        .action-btn:hover {
            transform: scale(1.1);
            background: rgba(0, 0, 0, 0.7);
        }

        .status-msg {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-top: 50px;
            width: 100%;
        }

        #playerBox {
            position: fixed;
            bottom: 20px;
            width: 90%;
            max-width: 800px;
            background: var(--player-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 15px 25px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            transform: translateY(200%);
            will-change: transform;
        }

        #playerBox.active {
            transform: translateY(0);
        }

        .player-main {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: space-between;
        }

        .player-info-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0;
        }

        .player-thumb {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            animation: spin 10s linear infinite;
            animation-play-state: paused;
        }

        .player-thumb.playing {
            animation-play-state: running;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .player-text {
            flex: 1;
            min-width: 0;
        }

        #currentTitle {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        #currentArtist {
            font-size: 13px;
            color: var(--primary);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .player-controls-extra {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            color: var(--text-main);
            transition: 0.2s;
        }

        .control-btn:hover {
            color: var(--primary);
            transform: scale(1.1);
        }

        .control-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .control-btn.fav svg {
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
        }

        .control-btn.fav.active svg {
            fill: var(--heart);
            stroke: var(--heart);
        }

        audio {
            width: 100%;
            height: 36px;
            border-radius: 5px;
            outline: none;
        }

        body:not(.light-mode) audio {
            filter: invert(1) hue-rotate(180deg) opacity(0.85);
        }

        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: var(--toast-bg);
            color: var(--text-main);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 250px;
            border: 1px solid var(--glass-border);
        }

        .toast::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--primary);
            animation: progress 4s linear forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes progress {
            from {
                width: 100%;
            }

            to {
                width: 0%;
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.5rem;
            }

            .grid-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            #playerBox {
                width: 96%;
                bottom: 10px;
                padding: 12px 15px;
            }

            .card {
                padding: 10px;
            }

            .nav-tabs {
                width: 90%;
                justify-content: center;
            }

            .header-container {
                width: 95%;
            }
        }
    </style>
</head>

<body>

    <div id="toast-container"></div>

    <div class="header-container">
        <button class="theme-btn" onclick="toggleTheme()" aria-label="Toggle Theme">
            <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>

        <h1>JioSaavn Player</h1>

        <div style="width: 40px;"></div>
    </div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('search')">Search</button>
        <button class="tab-btn" onclick="switchTab('favorites')">Favorites</button>
        <button class="tab-btn" onclick="switchTab('queue')">Queue</button>
    </div>

    <div id="searchView" class="view-section">
        <div class="search-container">
            <input id="searchBox" type="text" placeholder="Search song, artist..." />
        </div>
        <div id="searchResults" class="grid-container">
            <div class="status-msg">üöÄ Type to start searching...</div>
        </div>
    </div>

    <div id="favoritesView" class="view-section hidden">
        <div id="favResults" class="grid-container"></div>
    </div>

    <div id="queueView" class="view-section hidden">
        <div class="header-container" style="justify-content: center; margin: 0 0 15px 0;">
            <span style="color: var(--text-muted); font-size: 14px;">Next Up</span>
        </div>
        <div id="queueResults" class="list-container">
            <div class="status-msg">Queue is empty üéµ</div>
        </div>
    </div>

    <div id="playerBox">
        <div class="player-main">
            <div class="player-info-container">
                <img id="playerThumb" class="player-thumb" src="https://placehold.co/50" alt="Cover">
                <div class="player-text">
                    <div id="currentTitle">Not Playing</div>
                    <div id="currentArtist">-</div>
                </div>
            </div>

            <div class="player-controls-extra">
                <button class="control-btn" onclick="playPrev()">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 20L9 12l10-8v16zM5 19h2V5H5v14z"></path>
                    </svg>
                </button>

                <button class="control-btn" onclick="playNext()">
                    <svg viewBox="0 0 24 24">
                        <path d="M5 4l10 8-10 8V4zm14 1v14h-2V5h2z"></path>
                    </svg>
                </button>

                <button id="playerFavBtn" class="control-btn fav" onclick="togglePlayerFavorite()">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                        </path>
                    </svg>
                </button>
            </div>
        </div>

        <audio id="audioPlayer" controls controlsList="nodownload"></audio>
    </div>

    <script>
        const API_BASE = "https://jiosaavn-api.bhargavtodimela4.workers.dev/api/search/songs?query=";
        const STORAGE_FAVS = "jiosaavn_favorites_v1";
        const STORAGE_THEME = "jiosaavn_theme";

        let currentSongData = null;
        let searchDebounceTimer;
        let queue = [];
        let queueIndex = -1;
        const preloadCache = new Set();

        const searchBox = document.getElementById("searchBox");
        const searchResults = document.getElementById("searchResults");
        const favResults = document.getElementById("favResults");
        const queueResults = document.getElementById("queueResults");
        const playerBox = document.getElementById("playerBox");
        const audioPlayer = document.getElementById("audioPlayer");
        const playerTitle = document.getElementById("currentTitle");
        const playerArtist = document.getElementById("currentArtist");
        const playerThumb = document.getElementById("playerThumb");
        const playerFavBtn = document.getElementById("playerFavBtn");
        const themeIcon = document.getElementById("themeIcon");

        initTheme();

        searchBox.addEventListener("input", function (e) {
            clearTimeout(searchDebounceTimer);
            const query = this.value.trim();
            if (!query) {
                searchResults.innerHTML = '<div class="status-msg">üöÄ Type to start searching...</div>';
                return;
            }
            searchDebounceTimer = setTimeout(() => performSearch(query), 500);
        });

        searchBox.addEventListener("keydown", (e) => {
            if (e.key === "Enter") searchBox.blur();
        });

        audioPlayer.addEventListener('ended', () => {
            playNext(true);
        });

        audioPlayer.onpause = () => playerThumb.classList.remove("playing");
        audioPlayer.onplay = () => playerThumb.classList.add("playing");

        function initTheme() {
            const theme = localStorage.getItem(STORAGE_THEME) || 'dark';
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                updateThemeIcon(true);
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem(STORAGE_THEME, isLight ? 'light' : 'dark');
            updateThemeIcon(isLight);
        }

        function updateThemeIcon(isLight) {
            if (isLight) {
                themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            } else {
                themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));

            document.querySelector(`button[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}View`).classList.remove('hidden');

            if (tab === 'favorites') renderFavorites();
            if (tab === 'queue') renderQueue();
        }

        async function performSearch(query) {
            searchResults.innerHTML = '<div class="status-msg">Searching...</div>';
            try {
                const res = await fetch(API_BASE + encodeURIComponent(query));
                const data = await res.json();

                if (!data.success || !data.data.results || data.data.results.length === 0) {
                    searchResults.innerHTML = '<div class="status-msg">No results found üòî</div>';
                    return;
                }

                const songs = data.data.results.map(s => ({
                    id: s.id,
                    title: (s.name || "Unknown").replace(/'/g, "&apos;").replace(/"/g, "&quot;"),
                    artist: (s.artists?.primary?.map(a => a.name).join(", ") || "Unknown").replace(/'/g, "&apos;"),
                    image: s.image?.[2]?.url || s.image?.[0]?.url || "",
                    audio: s.downloadUrl?.[s.downloadUrl.length - 1]?.url
                })).filter(s => s.audio);

                renderGrid(songs, searchResults);

            } catch (error) {
                console.error(error);
                searchResults.innerHTML = '<div class="status-msg">Error connecting to server.</div>';
            }
        }

        function renderGrid(songs, container) {
            const fragment = document.createDocumentFragment();
            const favs = getFavorites();
            const favIds = new Set(favs.map(f => f.id));

            songs.forEach(song => {
                const isFav = favIds.has(song.id);
                const card = document.createElement('div');
                card.className = 'card';

                card.addEventListener('mouseenter', () => preloadAudio(song.audio));

                card.innerHTML = `
                <div class="card-actions">
                    <button class="action-btn" title="Add to Queue" onclick="addToQueueUI(event, '${song.id}')">
                        <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                    <button class="action-btn fav ${isFav ? 'active' : ''}" onclick="toggleLike(event, '${song.id}')">
                        <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    </button>
                </div>
                <div onclick="playNewSong('${song.id}')">
                    <img src="${song.image}" loading="lazy" alt="${song.title}">
                    <div class="card-content">
                        <div class="card-title">${song.title}</div>
                        <div class="card-artist">${song.artist}</div>
                    </div>
                </div>
            `;
                card.dataset.song = JSON.stringify(song);
                fragment.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(fragment);
        }

        function preloadAudio(url) {
            if (preloadCache.has(url)) return;
            const audio = new Audio();
            audio.src = url;
            audio.preload = 'auto';
            preloadCache.add(url);
        }

        function renderFavorites() {
            const favs = getFavorites().reverse();
            if (favs.length === 0) {
                favResults.innerHTML = '<div class="status-msg">No favorites yet ‚ù§Ô∏è</div>';
            } else {
                renderGrid(favs, favResults);
            }
        }

        function renderQueue() {
            if (queue.length === 0) {
                queueResults.innerHTML = '<div class="status-msg">Queue is empty üéµ</div>';
                return;
            }

            let html = '';
            queue.forEach((song, idx) => {
                const isActive = (idx === queueIndex) ? 'active' : '';
                html += `
                <div class="queue-item ${isActive}">
                    <img src="${song.image}" alt="">
                    <div class="queue-info">
                        <div style="font-weight:600; font-size:14px; color:var(--text-main)">${song.title}</div>
                        <div style="font-size:12px; color:var(--text-muted)">${song.artist}</div>
                    </div>
                    <div class="queue-actions">
                        <button class="queue-btn" onclick="moveQueueItem(${idx}, -1)" title="Move Up">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg>
                        </button>
                        <button class="queue-btn" onclick="moveQueueItem(${idx}, 1)" title="Move Down">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </button>
                        <button class="queue-btn" onclick="playFromQueue(${idx})" title="Play">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                        </button>
                    </div>
                </div>
             `;
            });
            queueResults.innerHTML = html;
        }

        function moveQueueItem(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= queue.length) return;

            const item = queue.splice(index, 1)[0];
            queue.splice(newIndex, 0, item);

            if (queueIndex === index) {
                queueIndex = newIndex;
            } else if (queueIndex === newIndex) {
                queueIndex = index;
            }

            renderQueue();
        }

        function playNewSong(id) {
            const card = document.querySelector(`.card[data-song*='${id}']`);
            if (!card) return;
            const song = JSON.parse(card.dataset.song);

            queue.push(song);
            queueIndex = queue.length - 1;

            playSong(song);
        }

        function playSong(song) {
            currentSongData = song;

            playerTitle.innerText = song.title;
            playerArtist.innerText = song.artist;
            playerThumb.src = song.image;
            updatePlayerHeart();

            playerBox.classList.add("active");
            playerThumb.classList.add("playing");

            audioPlayer.src = song.audio;
            audioPlayer.play().catch(e => console.log("Autoplay blocked", e));

            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: song.title,
                    artist: song.artist,
                    artwork: [{ src: song.image, sizes: '500x500', type: 'image/jpeg' }]
                });
                navigator.mediaSession.setActionHandler('play', () => audioPlayer.play());
                navigator.mediaSession.setActionHandler('pause', () => audioPlayer.pause());
                navigator.mediaSession.setActionHandler('previoustrack', playPrev);
                navigator.mediaSession.setActionHandler('nexttrack', playNext);
            }
        }

        function playNext(auto = false) {
            if (queue.length === 0) return;

            if (queueIndex < queue.length - 1) {
                queueIndex++;
                playSong(queue[queueIndex]);
                if (document.getElementById('queueView').style.display !== 'none') renderQueue();
            } else {
                if (auto) playerThumb.classList.remove("playing");
            }
        }

        function playPrev() {
            if (queueIndex > 0) {
                queueIndex--;
                playSong(queue[queueIndex]);
                if (document.getElementById('queueView').style.display !== 'none') renderQueue();
            } else {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            }
        }

        function playFromQueue(idx) {
            queueIndex = idx;
            playSong(queue[idx]);
            renderQueue();
        }

        function addToQueueUI(e, id) {
            e.stopPropagation();
            const card = e.currentTarget.closest('.card');
            const song = JSON.parse(card.dataset.song);

            queue.push(song);
            showToast("Added to Queue");

            const btn = e.currentTarget;
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            setTimeout(() => btn.innerHTML = originalContent, 1000);
        }

        function getFavorites() {
            return JSON.parse(localStorage.getItem(STORAGE_FAVS)) || [];
        }

        function toggleLike(e, id) {
            e.stopPropagation();
            const btn = e.currentTarget;
            const card = btn.closest('.card');
            const songData = JSON.parse(card.dataset.song);

            let favs = getFavorites();
            const index = favs.findIndex(f => f.id === id);

            if (index > -1) {
                favs.splice(index, 1);
                btn.classList.remove('active');
                if (!document.getElementById('favoritesView').classList.contains('hidden')) {
                    card.remove();
                }
                showToast("Removed from Favorites");
            } else {
                favs.push(songData);
                btn.classList.add('active');
                showToast("Added to Favorites");
            }
            localStorage.setItem(STORAGE_FAVS, JSON.stringify(favs));

            if (currentSongData && currentSongData.id === id) updatePlayerHeart();
        }

        function togglePlayerFavorite() {
            if (!currentSongData) return;
            let favs = getFavorites();
            const index = favs.findIndex(f => f.id === currentSongData.id);

            if (index > -1) {
                favs.splice(index, 1);
                showToast("Removed from Favorites");
            } else {
                favs.push(currentSongData);
                showToast("Added to Favorites");
            }
            localStorage.setItem(STORAGE_FAVS, JSON.stringify(favs));
            updatePlayerHeart();

            if (!document.getElementById('searchView').classList.contains('hidden')) {
                const btn = document.querySelector(`.card[data-song*='${currentSongData.id}'] .action-btn.fav`);
                if (btn) btn.classList.toggle('active');
            } else if (!document.getElementById('favoritesView').classList.contains('hidden')) {
                renderFavorites();
            }
        }

        function updatePlayerHeart() {
            const favs = getFavorites();
            const isFav = favs.some(f => f.id === currentSongData.id);
            if (isFav) playerFavBtn.classList.add('active');
            else playerFavBtn.classList.remove('active');
        }

        function showToast(message) {
            const container = document.getElementById("toast-container");
            const toast = document.createElement("div");
            toast.className = "toast";
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = "fadeIn 0.3s reverse forwards";
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>

</body>

</html>
